/*
 * i2c.c
 *
 *  Created on: Oct 29, 2019
 *      Author: PoopieJoe
 */

#include "hdr/i2c.h"

unsigned char axi_i2c_setup ( void )
{
	*AXI_I2C_CR				= ( *AXI_I2C_CR ) 	| 0x1		//enable the axi module
												| 0x2;		//enable tx reset
	*AXI_I2C_TX_FIFO 		= 0x0;							//clear tx fifo
	*AXI_I2C_RX_FIFO_PIRQ 	= 0x2 - 1;						//set rx fifo depth to two
	*AXI_I2C_CR				= ( *AXI_I2C_CR ) 	& (!0x2);	//clear tx reset
	*AXI_I2C_IER			= ( *AXI_I2C_IER ) 	| 0x8;		//enable rx fifo filled interrupt
	*AXI_I2C_CR				= ( *AXI_I2C_CR )	& (!0x20);	//disable general call
	return 0;
}

unsigned char axi_i2c_reg_read ( i2c_addr_t slave , unsigned char reg[2] )
{
	if ( (*AXI_I2C_SR) & (0x4) )
	{
		return 1;
	}
	return 0;
}


